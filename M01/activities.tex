\subsection{Activities}

\subsubsection{Interface PCB between the camera and the raspberry pi.}
During the first day a bill of materials for a PCB was done (Table \ref{tab_bompic}). The PCB had to connect the OV7670 camera and the raspberry with the objective of adding computer vision capabilities to Carrita. The difference with UDEM's approach is that this must send to the raspberry:
\begin{itemize}
	\item Maximum resolution (640x480).
	\item Maximum framerate (30fps).
	\item Color image.
\end{itemize}
\input{tab/bompic.tex}
It can be seen from the bill of materials (Table \ref{tab_bompic}):
\begin{itemize}
	\item It is expensive.
	\begin{itemize}
		\item 40.74 euros of the components of one PCB.
		\item 33.99 euros of the programmer.
	\end{itemize}
	\item There are minimum order quantities.
	\item PCB manufacturing is not included.
	\item UDEM's microcontroller could not be used.
	\item The PCB would have to be designed from scratch with less tools and materials available.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Microchip alternative.}
Due to the expensiveness in both money (components) and time (design and manufacturing) that the design of a new communication PCB was found to be I proceded to seek for an alternative. The best alternative found was to use an STM32 microcontroller, because:

\begin{itemize}
	\item It has a Digital Camera Module Interface (DCMI).
	\item It features Direct Memory Access (DMA).
	\item Using DCMI+DMA camera frames can be processed using hardware only (freeing the processor for other applications).
	\item Cheap evaluation boards exist (there is one at 12 euros and another at 21).
	\item Programming is done through standard USB cable.
	\item Varrier has experience and confidence in these brand of microcontrollers.
\end{itemize}

Research was done to validate the evaluation boards could do the communication with the camera. Also, research about whether the sensors and the LCD screen could be used simultaneously with the camera (or if their pins interfered). The final decision was to buy two 32F429IDISCOVERY.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Study and C implementation of the Hough transform.}
Line detection code implemented at UDEM uses OpenCV, a library with many computer vision algorithms. It is an objective to give Carrita a way to measure distance to a vehicle in front of it and that function has not been implemented.

Before starting the implementation I decided to remove the dependency on OpenCV and develop a C code version of the Hough transform based on the following facts:

\begin{itemize}
	\item OpenCV is a general computer vision library of many functions (the download of the current stable Linux version, 2.4.9, is 87MB).
	\item Only two "complex" functions were used for line detection.
	\begin{itemize}
		\item Canny edge detector.
		\item Hough transform.
		\item Probably less than 0.5\% of the total 87MB.
	\end{itemize}
	\item OpenCV's Hough transform can not be used to detect a vehicle in front of the cameras (it can only detect lines and circles).
	\item OpenCV does the full transform computation for each frame. Our application can (and must) take advantage of the knowing that the input is a video to compute as little as possible.
\end{itemize}

We also have the typical advantages of programming a library-free version of anything:
\begin{itemize}
	\item Deep knowledge about the transform (exposed functionality).
	\item Solution specific for the application (minimal, fast, only what is needed).
	\item Freedom in functionality, optimization and interfaces.
\end{itemize}

Raspberry Pi limit was going to be hit at some point and to push that limit further a specific solution without general libraries (such as OpenCV) would have to be developed.

To develop a C implementation of the Hough transform the following tasks were done:

\begin{itemize}
	\item Studied the theory behind the Hough transform.
	\item Sought and compared existing Hough transform code.
	\item Adapted to use only C (and reduce libraries).
	\item Implemented optimizations.
	\begin{itemize}
		\item Preprocessor (ab)use (branch reduction).
		\item Fixed point arithmetic.
		\item Trigonometric functions lookup tables.
		\item Statically allocated memory.
		\item Region of interest.
		\item Reduction of degrees of freedom.
	\end{itemize}
\end{itemize}

SDL was used to draw to the screen (it is not necesarry but it is useful to see the results) and fast-edge (http://goo.gl/ARWJZj) was adapted for edge-detection.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Bibliographical review of Hough transform applications.}
25 articles relevant to the application were downloaded. Applications of the Hough transform used to extract features (not only lines) off images have been observed. They mention transform's limitation, some approaches to overcome them, suggest improvements and/or show experimental results.

